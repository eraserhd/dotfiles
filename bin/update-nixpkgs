#!/usr/bin/env gxi

(import "lib/shell")

(define (update-branch branch)
  (sh "git" "fetch" "upstream")
  (sh "git" "checkout" branch)
  (sh "git" "reset" "--hard" (string-append "upstream/" branch))
  (sh "git" "push" "origin" branch))

(define (update-nixpkgs)
  (parameterize ((current-directory "~/src/dotfiles/nixpkgs"))
    (update-branch "master"))
  (parameterize ((current-directory "~/src/dotfiles"))
    (if (darwin?)
      (sh "darwin-rebuild" "build")
      (sh "nixos-rebuild" "build"))
    (sh "git" "add" "nixpkgs")
    (sh "git" "commit" "-m" "Bump nixpkgs" "nixpkgs")))

(define main update-nixpkgs)
